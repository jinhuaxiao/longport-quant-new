# Redisé˜Ÿåˆ—æ¸…ç†æŒ‡å—

**é—®é¢˜**: å¤„ç†ä¸­ä¿¡å·å †ç§¯ï¼ˆ573ä¸ªï¼‰
**åŸå› **: Order Executorå¤„ç†ç¼“æ…¢æˆ–æ‰§è¡Œå¤±è´¥
**çŠ¶æ€**: éœ€è¦æ¸…ç†

---

## ğŸš¨ ä¸ºä»€ä¹ˆä¼šå †ç§¯ï¼Ÿ

å¤„ç†ä¸­ä¿¡å·å †ç§¯é€šå¸¸ç”±ä»¥ä¸‹åŸå› é€ æˆï¼š

1. **Order Executorå´©æºƒ** - ä¿¡å·è¢«ç§»åˆ°processingé˜Ÿåˆ—åï¼Œexecutorå´©æºƒæœªèƒ½æ ‡è®°å®Œæˆ
2. **æ‰§è¡Œå¤±è´¥æœªå¤„ç†** - è®¢å•æ‰§è¡Œå¤±è´¥ä½†æœªè°ƒç”¨`mark_signal_failed()`
3. **å¼‚å¸¸é€€å‡º** - Ctrl+Cå¼ºåˆ¶é€€å‡ºå¯¼è‡´ä¿¡å·æœªæ¸…ç†
4. **é•¿æ—¶é—´æœªè¿è¡Œexecutor** - Signal GeneratoræŒç»­ç”Ÿæˆä¿¡å·ä½†æ— äººæ¶ˆè´¹

---

## ğŸ”§ å¿«é€Ÿæ¸…ç†æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨æ¸…ç†å·¥å…·ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œäº¤äº’å¼æ¸…ç†å·¥å…·
python3 scripts/cleanup_queues.py
```

**æ“ä½œæ­¥éª¤**:
1. æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼ˆè‡ªåŠ¨æ˜¾ç¤ºï¼‰
2. è¾“å…¥ `2` - æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—
3. è¾“å…¥ `y` ç¡®è®¤
4. å®Œæˆï¼

**ä¼˜ç‚¹**: å®‰å…¨ã€äº¤äº’å¼ã€å¯ä»¥æŸ¥çœ‹è¯¦æƒ…

---

### æ–¹æ¡ˆ2ï¼šç›´æ¥ä½¿ç”¨Rediså‘½ä»¤ï¼ˆæœ€å¿«ï¼‰

```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
redis-cli ZCARD trading:signals:processing

# åˆ é™¤å¤„ç†ä¸­é˜Ÿåˆ—ï¼ˆ573ä¸ªä¿¡å·ä¼šè¢«åˆ é™¤ï¼‰
redis-cli DEL trading:signals:processing

# éªŒè¯
redis-cli ZCARD trading:signals:processing
# åº”è¿”å›: (integer) 0
```

**ä¼˜ç‚¹**: æœ€å¿«
**ç¼ºç‚¹**: ä¸å¯æ¢å¤

---

### æ–¹æ¡ˆ3ï¼šç§»å›ä¸»é˜Ÿåˆ—ï¼ˆæ¢å¤æ¨¡å¼ï¼‰

å¦‚æœè¿™äº›ä¿¡å·ä»ç„¶æœ‰æ•ˆï¼Œå¯ä»¥å°†å®ƒä»¬ç§»å›ä¸»é˜Ÿåˆ—é‡æ–°å¤„ç†ï¼š

```bash
# è¿è¡Œæ¸…ç†å·¥å…·
python3 scripts/cleanup_queues.py

# é€‰æ‹©æ“ä½œ 6 - å°†å¤„ç†ä¸­ä¿¡å·ç§»å›ä¸»é˜Ÿåˆ—
# è¿™ä¼šå°†573ä¸ªä¿¡å·é‡æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œä½†ä¼˜å…ˆçº§ä¼šé™ä½20åˆ†
```

**ä¼˜ç‚¹**: ä¿¡å·ä¸ä¼šä¸¢å¤±
**ç¼ºç‚¹**: å¦‚æœä¿¡å·å·²è¿‡æœŸï¼ˆä»·æ ¼å˜åŒ–ï¼‰ï¼Œå¯èƒ½ä¸å†æœ‰æ•ˆ

---

## ğŸ“‹ æ¸…ç†å·¥å…·åŠŸèƒ½è¯´æ˜

### ä¸»èœå•

```
1. æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€                 - æŸ¥çœ‹å„é˜Ÿåˆ—çš„ä¿¡å·æ•°é‡
2. æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—ï¼ˆåˆ é™¤ï¼‰        - åˆ é™¤æ‰€æœ‰processingä¿¡å·
3. æ¸…ç†å¤±è´¥é˜Ÿåˆ—ï¼ˆåˆ é™¤ï¼‰          - åˆ é™¤æ‰€æœ‰failedä¿¡å·
4. æ¸…ç†ä¸»é˜Ÿåˆ—ï¼ˆåˆ é™¤ï¼‰            - åˆ é™¤æ‰€æœ‰å¾…å¤„ç†ä¿¡å·
5. æ¸…ç†æ‰€æœ‰é˜Ÿåˆ—ï¼ˆå±é™©ï¼ï¼‰        - æ¸…ç©ºæ•´ä¸ªé˜Ÿåˆ—ç³»ç»Ÿ
6. å°†å¤„ç†ä¸­ä¿¡å·ç§»å›ä¸»é˜Ÿåˆ—        - æ¢å¤processingä¿¡å·
7. æŸ¥çœ‹å¾…å¤„ç†ä¿¡å·ç¤ºä¾‹            - æ˜¾ç¤ºmainé˜Ÿåˆ—å‰10ä¸ªä¿¡å·
8. æŸ¥çœ‹å¤„ç†ä¸­ä¿¡å·ç¤ºä¾‹            - æ˜¾ç¤ºprocessingé˜Ÿåˆ—å‰10ä¸ªä¿¡å·
9. æŸ¥çœ‹å¤±è´¥ä¿¡å·ç¤ºä¾‹              - æ˜¾ç¤ºfailedé˜Ÿåˆ—å‰10ä¸ªä¿¡å·
0. é€€å‡º
```

### ä½¿ç”¨ç¤ºä¾‹

**æŸ¥çœ‹å½“å‰çŠ¶æ€**:
```bash
python3 scripts/cleanup_queues.py
```

è¾“å‡ºï¼š
```
======================================================================
ğŸ“Š å½“å‰é˜Ÿåˆ—çŠ¶æ€
======================================================================
  ğŸ“¥ å¾…å¤„ç†é˜Ÿåˆ— (main):       12 ä¸ªä¿¡å·
  âš™ï¸  å¤„ç†ä¸­é˜Ÿåˆ— (processing): 573 ä¸ªä¿¡å·  â† é—®é¢˜ï¼
  âŒ å¤±è´¥é˜Ÿåˆ— (failed):        5 ä¸ªä¿¡å·
======================================================================
```

**æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—**:
```
è¯·é€‰æ‹©æ“ä½œ (0-9): 2

âš ï¸  ç¡®è®¤æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—ï¼Ÿ(y/N): y

ğŸ”„ æ­£åœ¨æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—...
âœ… å·²æ¸…ç† 573 ä¸ªå¤„ç†ä¸­ä¿¡å·

======================================================================
ğŸ“Š å½“å‰é˜Ÿåˆ—çŠ¶æ€
======================================================================
  ğŸ“¥ å¾…å¤„ç†é˜Ÿåˆ— (main):       12 ä¸ªä¿¡å·
  âš™ï¸  å¤„ç†ä¸­é˜Ÿåˆ— (processing): 0 ä¸ªä¿¡å·  â† å·²æ¸…ç†ï¼
  âŒ å¤±è´¥é˜Ÿåˆ— (failed):        5 ä¸ªä¿¡å·
======================================================================
```

---

## ğŸ” è¯Šæ–­å’Œé¢„é˜²

### ä¸ºä»€ä¹ˆä¼šå †ç§¯573ä¸ªï¼Ÿ

**æ£€æŸ¥Order Executoræ˜¯å¦è¿è¡Œ**:
```bash
ps aux | grep order_executor
```

**å¦‚æœæ²¡æœ‰è¿è¡Œ**:
```bash
# è¯´æ˜ä¹‹å‰executorå´©æºƒæˆ–è¢«åœæ­¢äº†
# è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¿¡å·å †ç§¯åœ¨processingé˜Ÿåˆ—

# å¯åŠ¨executor
python3 scripts/order_executor.py &
```

**æŸ¥çœ‹executoræ—¥å¿—**:
```bash
tail -f logs/order_executor_*.log
```

**å¸¸è§é”™è¯¯**:
```log
# é”™è¯¯1: æ•°æ®åº“è¿æ¥å¤±è´¥
âŒ è·å–è´¦æˆ·ä¿¡æ¯å¤±è´¥: could not connect to server

# é”™è¯¯2: APIè°ƒç”¨å¤±è´¥
âŒ æ‰§è¡Œè®¢å•å¤±è´¥: API rate limit exceeded

# é”™è¯¯3: èµ„é‡‘ä¸è¶³
âš ï¸ 9992.HK: èµ„é‡‘ä¸è¶³ (éœ€è¦: $29,100, å¯ç”¨: $10,000)
```

### é¢„é˜²æªæ–½

#### 1. ç›‘æ§Order ExecutorçŠ¶æ€

åˆ›å»ºç›‘æ§è„šæœ¬ `scripts/check_executor.sh`:
```bash
#!/bin/bash
if ! pgrep -f "order_executor.py" > /dev/null; then
    echo "âš ï¸ Order Executoræœªè¿è¡Œï¼"
    echo "å¯åŠ¨å‘½ä»¤: python3 scripts/order_executor.py &"
else
    echo "âœ… Order Executoræ­£åœ¨è¿è¡Œ"
fi
```

#### 2. å®šæœŸæ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€

```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
# crontab -e
0 * * * * cd /data/web/longport-quant-new && python3 scripts/queue_monitor.py >> logs/queue_monitor.log
```

#### 3. ä½¿ç”¨è¿›ç¨‹ç®¡ç†å·¥å…·

ä½¿ç”¨`supervisord`æˆ–`systemd`ç®¡ç†è¿›ç¨‹ï¼Œè‡ªåŠ¨é‡å¯å´©æºƒçš„executorã€‚

#### 4. æ”¹è¿›Order Executoré”™è¯¯å¤„ç†

ç¡®ä¿æ‰€æœ‰å¼‚å¸¸éƒ½æ­£ç¡®è°ƒç”¨`mark_signal_failed()`æˆ–`mark_signal_completed()`ã€‚

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ¸…ç†åç«‹å³åˆå †ç§¯

**ç—‡çŠ¶**: æ¸…ç†processingé˜Ÿåˆ—åï¼Œå‡ åˆ†é’Ÿå†…åˆå †ç§¯äº†å¾ˆå¤š

**åŸå› **: Order Executoræ­£åœ¨è¿è¡Œä½†å¤„ç†å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹executoræ—¥å¿—
tail -f logs/order_executor_*.log | grep "âŒ"

# å¸¸è§é—®é¢˜ï¼š
# - APIè°ƒç”¨å¤±è´¥
# - æ•°æ®åº“è¿æ¥æ–­å¼€
# - èµ„é‡‘ä¸è¶³
```

**è§£å†³**: ä¿®å¤æ ¹æœ¬é—®é¢˜åå†é‡å¯

---

### é—®é¢˜2ï¼šmainé˜Ÿåˆ—å’Œprocessingé˜Ÿåˆ—éƒ½å¾ˆå¤š

**ç—‡çŠ¶**:
```
ğŸ“¥ å¾…å¤„ç†é˜Ÿåˆ— (main):       150 ä¸ªä¿¡å·
âš™ï¸  å¤„ç†ä¸­é˜Ÿåˆ— (processing): 573 ä¸ªä¿¡å·
```

**åŸå› **:
- Signal Generatorç”Ÿæˆé€Ÿåº¦ > Executorå¤„ç†é€Ÿåº¦
- æˆ–è€…Executoræ ¹æœ¬æ²¡è¿è¡Œ

**è§£å†³**:
```bash
# 1. åœæ­¢signal generatorï¼ˆåœæ­¢æ–°ä¿¡å·ç”Ÿæˆï¼‰
pkill -f signal_generator.py

# 2. æ¸…ç†å¤„ç†ä¸­é˜Ÿåˆ—
redis-cli DEL trading:signals:processing

# 3. å¯åŠ¨æ›´å¤šexecutorå®ä¾‹ï¼ˆæé«˜å¤„ç†é€Ÿåº¦ï¼‰
python3 scripts/order_executor.py &
python3 scripts/order_executor.py &
python3 scripts/order_executor.py &

# 4. ç›‘æ§å¤„ç†é€Ÿåº¦
python3 scripts/queue_monitor.py

# 5. ç­‰å¾…mainé˜Ÿåˆ—æ¸…ç©ºåï¼Œå†å¯åŠ¨signal generator
python3 scripts/signal_generator.py &
```

---

### é—®é¢˜3ï¼šæ¸…ç†åç³»ç»Ÿä¸å·¥ä½œ

**ç—‡çŠ¶**: æ¸…ç†æ‰€æœ‰é˜Ÿåˆ—åï¼Œç³»ç»Ÿä¸å†ç”Ÿæˆæˆ–å¤„ç†ä¿¡å·

**æ£€æŸ¥**:
```bash
# 1. ç¡®è®¤Redisæ­£å¸¸
redis-cli ping

# 2. ç¡®è®¤signal generatorè¿è¡Œ
ps aux | grep signal_generator

# 3. ç¡®è®¤order executorè¿è¡Œ
ps aux | grep order_executor

# 4. æŸ¥çœ‹æ—¥å¿—
tail -f logs/signal_generator.log
tail -f logs/order_executor_*.log
```

**è§£å†³**: é‡å¯æ•´ä¸ªç³»ç»Ÿ
```bash
bash scripts/stop_trading_system.sh
bash scripts/start_trading_system.sh 3
```

---

## ğŸ“Š æ¨èçš„æ¸…ç†ç­–ç•¥

### åœºæ™¯1ï¼šOrder Executoré•¿æ—¶é—´æœªè¿è¡Œ

**çŠ¶å†µ**: processingé˜Ÿåˆ—å †ç§¯å¤§é‡æ—§ä¿¡å·ï¼ˆè¶…è¿‡1å°æ—¶ï¼‰

**ç­–ç•¥**: **ç›´æ¥åˆ é™¤**
```bash
redis-cli DEL trading:signals:processing
```

**ç†ç”±**:
- æ—§ä¿¡å·çš„ä»·æ ¼å·²å¤±æ•ˆ
- é‡æ–°ç”Ÿæˆæ›´å‡†ç¡®

---

### åœºæ™¯2ï¼šOrder Executoråˆšå´©æºƒï¼ˆ<10åˆ†é’Ÿï¼‰

**çŠ¶å†µ**: processingé˜Ÿåˆ—æœ‰å°‘é‡æ–°ä¿¡å·ï¼ˆ<50ä¸ªï¼‰

**ç­–ç•¥**: **ç§»å›ä¸»é˜Ÿåˆ—**
```bash
python3 scripts/cleanup_queues.py
# é€‰æ‹© 6 - å°†å¤„ç†ä¸­ä¿¡å·ç§»å›ä¸»é˜Ÿåˆ—
```

**ç†ç”±**:
- ä¿¡å·ä»ç„¶æœ‰æ•ˆ
- ä¸æµªè´¹åˆ†æç»“æœ

---

### åœºæ™¯3ï¼šç³»ç»Ÿè¿è¡Œæ­£å¸¸ä½†processingé˜Ÿåˆ—æ…¢æ…¢å¢é•¿

**çŠ¶å†µ**:
- processing: æŒç»­åœ¨10-50ä¹‹é—´æ³¢åŠ¨
- æ¯å°æ—¶å¢é•¿5-10ä¸ª

**ç­–ç•¥**: **åˆ†ææ ¹æœ¬åŸå› **
```bash
# æŸ¥çœ‹å¤„ç†ä¸­ä¿¡å·ç¤ºä¾‹
python3 scripts/cleanup_queues.py
# é€‰æ‹© 8 - æŸ¥çœ‹å¤„ç†ä¸­ä¿¡å·ç¤ºä¾‹

# æ£€æŸ¥è¿™äº›ä¿¡å·ä¸ºä»€ä¹ˆå¤„ç†å¤±è´¥
tail -f logs/order_executor_*.log | grep "è¿™äº›æ ‡çš„ä»£ç "
```

**å¯èƒ½åŸå› **:
- ç‰¹å®šæ ‡çš„æ€»æ˜¯å¤±è´¥ï¼ˆå¦‚åœç‰Œã€æ— æƒé™ï¼‰
- ç½‘ç»œé—®é¢˜å¯¼è‡´APIè°ƒç”¨è¶…æ—¶
- æ•°æ®åº“è¿æ¥æ± è€—å°½

---

## ğŸš€ æ‰§è¡Œæ¸…ç†ï¼ˆå½“å‰æƒ…å†µï¼‰

å¯¹äºä½ å½“å‰çš„573ä¸ªå †ç§¯ä¿¡å·ï¼Œæ¨èæ–¹æ¡ˆï¼š

### å¿«é€Ÿæ¸…ç†ï¼ˆ5ç§’ï¼‰

```bash
# ç›´æ¥åˆ é™¤å¤„ç†ä¸­é˜Ÿåˆ—
redis-cli DEL trading:signals:processing

# éªŒè¯
redis-cli ZCARD trading:signals:processing
# åº”æ˜¾ç¤º: (integer) 0

# æ£€æŸ¥å…¶ä»–é˜Ÿåˆ—
redis-cli ZCARD trading:signals
redis-cli ZCARD trading:signals:failed
```

### å®Œæ•´æ¸…ç†ï¼ˆå¦‚æœmainå’Œfailedé˜Ÿåˆ—ä¹Ÿéœ€è¦æ¸…ç†ï¼‰

```bash
# æ¸…ç†æ‰€æœ‰é˜Ÿåˆ—
redis-cli DEL trading:signals trading:signals:processing trading:signals:failed

# éªŒè¯
redis-cli ZCARD trading:signals
redis-cli ZCARD trading:signals:processing
redis-cli ZCARD trading:signals:failed
# å…¨éƒ¨åº”æ˜¾ç¤º: (integer) 0
```

### æ¸…ç†åé‡å¯ç³»ç»Ÿ

```bash
# ç¡®ä¿æ—§è¿›ç¨‹å·²åœæ­¢
pkill -f signal_generator.py
pkill -f order_executor.py

# ç­‰å¾…2ç§’
sleep 2

# å¯åŠ¨æ–°ç³»ç»Ÿ
bash scripts/start_trading_system.sh 3

# ç›‘æ§çŠ¶æ€
python3 scripts/queue_monitor.py
```

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

- `HOW_SIGNALS_ARE_PROCESSED.md` - ä¿¡å·å¤„ç†æµç¨‹è¯¦è§£
- `SIGNAL_DEDUPLICATION.md` - ä¿¡å·å»é‡æœºåˆ¶
- `WHY_NO_ORDERS.md` - ä¸ºä»€ä¹ˆæ²¡æœ‰ä¸‹å•çš„è¯Šæ–­

---

**çŠ¶æ€**: ğŸ› ï¸ å·¥å…·å·²å°±ç»ªï¼Œè¯·é€‰æ‹©åˆé€‚çš„æ¸…ç†æ–¹æ¡ˆ
**å»ºè®®**: å¯¹äº573ä¸ªæ—§ä¿¡å·ï¼Œç›´æ¥åˆ é™¤å³å¯
