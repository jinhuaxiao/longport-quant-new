# å¸‚åœºæ„ŸçŸ¥æ™ºèƒ½äº¤æ˜“

## æ¦‚è¿°

é«˜çº§æŠ€æœ¯æŒ‡æ ‡äº¤æ˜“ç³»ç»ŸçŽ°åœ¨æ”¯æŒ**å¸‚åœºæ„ŸçŸ¥**åŠŸèƒ½ï¼Œæ ¹æ®ä¸åŒå¸‚åœºçš„äº¤æ˜“æ—¶é—´ï¼Œæ™ºèƒ½åœ°åªç›‘æŽ§å’Œäº¤æ˜“æ´»è·ƒå¸‚åœºçš„æ ‡çš„ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨è¯†åˆ«æ´»è·ƒå¸‚åœº

ç³»ç»Ÿä¼šæ ¹æ®å½“å‰åŒ—äº¬æ—¶é—´è‡ªåŠ¨åˆ¤æ–­å“ªäº›å¸‚åœºæ­£åœ¨äº¤æ˜“ï¼š

| å¸‚åœº | äº¤æ˜“æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ | è¯´æ˜Ž |
|------|-------------------|------|
| **æ¸¯è‚¡** | 09:30-12:00, 13:00-16:00 | æ—©ç›˜ + åˆç›˜ |
| **ç¾Žè‚¡** | 21:30-æ¬¡æ—¥04:00 | å¤ä»¤æ—¶/å†¬ä»¤æ—¶ |

### 2. æ™ºèƒ½æ ‡çš„è¿‡æ»¤

- **æ¸¯è‚¡äº¤æ˜“æ—¶æ®µ**ï¼šåªç›‘æŽ§ `.HK` åŽç¼€çš„æ ‡çš„
- **ç¾Žè‚¡äº¤æ˜“æ—¶æ®µ**ï¼šåªç›‘æŽ§ `.US` åŽç¼€çš„æ ‡çš„
- **é‡å æ—¶æ®µ**ï¼šåŒæ—¶ç›‘æŽ§ä¸¤ä¸ªå¸‚åœºçš„æ ‡çš„
- **éžäº¤æ˜“æ—¶æ®µ**ï¼šä¸ç›‘æŽ§ä»»ä½•æ ‡çš„ï¼Œç³»ç»Ÿå¾…æœº

### 3. æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŠ¿ï¼š**
- âœ… å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨
- âœ… é™ä½Žç½‘ç»œæµé‡å’Œå»¶è¿Ÿ
- âœ… æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦
- âœ… èŠ‚çœAPIé…é¢

**å¯¹æ¯”ï¼š**
```
ä¹‹å‰ï¼š
- æ¸¯è‚¡æ—¶é—´ä»èŽ·å–ç¾Žè‚¡è¡Œæƒ… â†’ 5ä¸ªæ ‡çš„ â†’ ä½†ç¾Žè‚¡ä»·æ ¼ä¸º0æˆ–æ˜¨æ”¶ä»·
- æµªè´¹2ä¸ªAPIè°ƒç”¨

çŽ°åœ¨ï¼š
- æ¸¯è‚¡æ—¶é—´åªèŽ·å–æ¸¯è‚¡è¡Œæƒ… â†’ 3ä¸ªæ ‡çš„ â†’ å‡å°‘40%çš„APIè°ƒç”¨
- ç¾Žè‚¡æ—¶é—´åªèŽ·å–ç¾Žè‚¡è¡Œæƒ… â†’ 2ä¸ªæ ‡çš„ â†’ å‡å°‘60%çš„APIè°ƒç”¨
```

## å®žçŽ°ç»†èŠ‚

### æ ¸å¿ƒæ–¹æ³•

#### 1. `get_active_markets()`

è¿”å›žå½“å‰æ´»è·ƒçš„å¸‚åœºåˆ—è¡¨ã€‚

```python
def get_active_markets(self):
    """
    èŽ·å–å½“å‰æ´»è·ƒçš„å¸‚åœº

    Returns:
        list: æ´»è·ƒå¸‚åœºåˆ—è¡¨ï¼Œå¦‚ ['HK'], ['US'], æˆ– ['HK', 'US']
    """
    now = datetime.now(self.beijing_tz)
    current_time = now.time()
    weekday = now.weekday()

    active_markets = []

    # å‘¨æœ«ä¸äº¤æ˜“
    if weekday >= 5:
        return active_markets

    # æ¸¯è‚¡äº¤æ˜“æ—¶æ®µï¼š9:30-12:00, 13:00-16:00
    hk_morning = time(9, 30) <= current_time <= time(12, 0)
    hk_afternoon = time(13, 0) <= current_time <= time(16, 0)
    if hk_morning or hk_afternoon:
        active_markets.append('HK')

    # ç¾Žè‚¡äº¤æ˜“æ—¶æ®µï¼ˆåŒ—äº¬æ—¶é—´ï¼‰ï¼š21:30-æ¬¡æ—¥4:00
    if current_time >= time(21, 30) or current_time <= time(4, 0):
        if weekday not in [5, 6]:  # æŽ’é™¤å‘¨æœ«
            active_markets.append('US')

    return active_markets
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
- ä¸Šåˆ10:00 â†’ `['HK']`
- æ™šä¸Š22:00 â†’ `['US']`
- å‘¨å…­å…¨å¤© â†’ `[]`

#### 2. `filter_symbols_by_market()`

æ ¹æ®æ´»è·ƒå¸‚åœºè¿‡æ»¤æ ‡çš„åˆ—è¡¨ã€‚

```python
def filter_symbols_by_market(self, symbols, active_markets):
    """
    æ ¹æ®æ´»è·ƒå¸‚åœºè¿‡æ»¤æ ‡çš„

    Args:
        symbols: æ ‡çš„åˆ—è¡¨ ['09988.HK', 'AAPL.US', ...]
        active_markets: æ´»è·ƒå¸‚åœºåˆ—è¡¨ ['HK', 'US']

    Returns:
        list: è¿‡æ»¤åŽçš„æ ‡çš„åˆ—è¡¨
    """
    if not active_markets:
        return []

    filtered = []
    for symbol in symbols:
        if 'HK' in active_markets and '.HK' in symbol:
            filtered.append(symbol)
        elif 'US' in active_markets and '.US' in symbol:
            filtered.append(symbol)

    return filtered
```

**ç¤ºä¾‹ï¼š**
```python
symbols = ['09988.HK', '03690.HK', 'AAPL.US', 'MSFT.US']
active_markets = ['HK']

filtered = filter_symbols_by_market(symbols, active_markets)
# ç»“æžœ: ['09988.HK', '03690.HK']
```

#### 3. ä¸»å¾ªçŽ¯é›†æˆ

```python
# 1. æ£€æŸ¥å½“å‰æ´»è·ƒå¸‚åœº
active_markets = self.get_active_markets()
if not active_markets:
    logger.info("â° å½“å‰æ—¶é—´: ä¸åœ¨äº¤æ˜“æ—¶æ®µ")
    await asyncio.sleep(60)
    continue

# 2. æ ¹æ®æ´»è·ƒå¸‚åœºè¿‡æ»¤æ ‡çš„
active_symbols = self.filter_symbols_by_market(symbols, active_markets)
if not active_symbols:
    logger.info(f"â° å½“å‰æ´»è·ƒå¸‚åœº {active_markets}ï¼Œä½†ç›‘æŽ§åˆ—è¡¨ä¸­æ— å¯¹åº”æ ‡çš„")
    await asyncio.sleep(60)
    continue

logger.info(f"ðŸ“ æ´»è·ƒå¸‚åœº: {', '.join(active_markets)} | ç›‘æŽ§æ ‡çš„: {len(active_symbols)}ä¸ª")

# 3. èŽ·å–å®žæ—¶è¡Œæƒ…ï¼ˆåªèŽ·å–æ´»è·ƒå¸‚åœºçš„æ ‡çš„ï¼‰
quotes = await self.get_realtime_quotes(active_symbols)
```

## è¿è¡Œç¤ºä¾‹

### æ¸¯è‚¡äº¤æ˜“æ—¶æ®µï¼ˆ10:00ï¼‰

```
======================================================================
ç¬¬ 1 è½®æ‰«æ - 10:00:00
======================================================================
ðŸ“ æ´»è·ƒå¸‚åœº: HK | ç›‘æŽ§æ ‡çš„: 3ä¸ª
ðŸ“Š èŽ·å–åˆ° 3 ä¸ªæ ‡çš„çš„å®žæ—¶è¡Œæƒ…

æ£€æŸ¥æŒä»“:
  âœ“ 09988.HK - å½“å‰ä»· $175.00 (æ´»è·ƒå¸‚åœºï¼Œå®žæ—¶æ£€æŸ¥)
  âœ“ 9988.HK - å½“å‰ä»· $175.00 (æŒä»“æ£€æŸ¥)
  âœ“ 857.HK - å½“å‰ä»· $7.05 (æŒä»“æ£€æŸ¥)
  - NVDA.US - è·³è¿‡ï¼ˆç¾Žè‚¡æœªå¼€ç›˜ï¼‰
```

### ç¾Žè‚¡äº¤æ˜“æ—¶æ®µï¼ˆ22:00ï¼‰

```
======================================================================
ç¬¬ 1 è½®æ‰«æ - 22:00:00
======================================================================
ðŸ“ æ´»è·ƒå¸‚åœº: US | ç›‘æŽ§æ ‡çš„: 2ä¸ª
ðŸ“Š èŽ·å–åˆ° 2 ä¸ªæ ‡çš„çš„å®žæ—¶è¡Œæƒ…

æ£€æŸ¥æŒä»“:
  âœ“ AAPL.US - å½“å‰ä»· $254.43 (æ´»è·ƒå¸‚åœºï¼Œå®žæ—¶æ£€æŸ¥)
  âœ“ NVDA.US - å½“å‰ä»· $181.85 (æŒä»“æ£€æŸ¥)
  - 09988.HK - è·³è¿‡ï¼ˆæ¸¯è‚¡å·²ä¼‘å¸‚ï¼‰
```

### éžäº¤æ˜“æ—¶æ®µï¼ˆ18:00ï¼‰

```
======================================================================
ç¬¬ 1 è½®æ‰«æ - 18:00:00
======================================================================
â° å½“å‰æ—¶é—´: ä¸åœ¨äº¤æ˜“æ—¶æ®µ

â³ ç­‰å¾…60ç§’è¿›å…¥ä¸‹ä¸€è½®...
```

## æŒä»“ç®¡ç†

### æŒä»“æ£€æŸ¥é€»è¾‘

æŒä»“æ£€æŸ¥ä¹Ÿéµå¾ªå¸‚åœºæ„ŸçŸ¥è§„åˆ™ï¼š

1. **æ´»è·ƒå¸‚åœºçš„æŒä»“**ï¼šå®žæ—¶æ£€æŸ¥æ­¢æŸæ­¢ç›ˆ
2. **éžæ´»è·ƒå¸‚åœºçš„æŒä»“**ï¼šè·³è¿‡æ£€æŸ¥ï¼ˆå› ä¸ºä¸åœ¨ quotes åˆ—è¡¨ä¸­ï¼‰

**ç¤ºä¾‹ï¼š**
- æ¸¯è‚¡æ—¶é—´ï¼šæ£€æŸ¥æ¸¯è‚¡æŒä»“ï¼ˆ9988.HK, 857.HKç­‰ï¼‰
- ç¾Žè‚¡æ—¶é—´ï¼šæ£€æŸ¥ç¾Žè‚¡æŒä»“ï¼ˆNVDA.USç­‰ï¼‰

### ä¼˜åŠ¿

- åªåœ¨ç›¸å…³å¸‚åœºå¼€ç›˜æ—¶æ‰æ£€æŸ¥å¯¹åº”æŒä»“
- é¿å…ä½¿ç”¨è¿‡æ—¶çš„è¡Œæƒ…æ•°æ®åšå†³ç­–
- ä¿è¯æ­¢æŸæ­¢ç›ˆåˆ¤æ–­åŸºäºŽå®žæ—¶ä»·æ ¼

## é…ç½®

### è‡ªé€‰è‚¡é…ç½®

åœ¨ `configs/watchlist.yml` ä¸­é…ç½®ç›‘æŽ§æ ‡çš„ï¼š

```yaml
symbols:
  # æ¸¯è‚¡æ ‡çš„
  - symbol: "09988.HK"
    name: "é˜¿é‡Œå·´å·´"
  - symbol: "03690.HK"
    name: "ç¾Žå›¢"

  # ç¾Žè‚¡æ ‡çš„
  - symbol: "AAPL.US"
    name: "è‹¹æžœ"
  - symbol: "MSFT.US"
    name: "å¾®è½¯"
```

ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®åŽç¼€ï¼ˆ`.HK` / `.US`ï¼‰åˆ¤æ–­å¸‚åœºã€‚

### æ—¶åŒºé…ç½®

ç³»ç»Ÿä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆAsia/Shanghaiï¼‰ï¼š

```python
self.beijing_tz = ZoneInfo('Asia/Shanghai')
```

## æ‰©å±•æ”¯æŒ

### æ·»åŠ æ–°å¸‚åœº

å¦‚éœ€æ”¯æŒå…¶ä»–å¸‚åœºï¼ˆå¦‚Aè‚¡ã€æ–°åŠ å¡ç­‰ï¼‰ï¼Œåœ¨ `get_active_markets()` ä¸­æ·»åŠ ï¼š

```python
# Aè‚¡äº¤æ˜“æ—¶æ®µï¼š9:30-11:30, 13:00-15:00
a_morning = time(9, 30) <= current_time <= time(11, 30)
a_afternoon = time(13, 0) <= current_time <= time(15, 0)
if a_morning or a_afternoon:
    active_markets.append('CN')
```

å¹¶åœ¨ `filter_symbols_by_market()` ä¸­æ·»åŠ è¿‡æ»¤è§„åˆ™ï¼š

```python
elif 'CN' in active_markets and '.SH' in symbol or '.SZ' in symbol:
    filtered.append(symbol)
```

## æ—¥å¿—è¾“å‡º

ç³»ç»Ÿä¼šæ¸…æ™°åœ°æ˜¾ç¤ºå½“å‰ç›‘æŽ§çš„å¸‚åœºï¼š

```
ðŸ“ æ´»è·ƒå¸‚åœº: HK | ç›‘æŽ§æ ‡çš„: 3ä¸ª
ðŸ“ æ´»è·ƒå¸‚åœº: US | ç›‘æŽ§æ ‡çš„: 2ä¸ª
ðŸ“ æ´»è·ƒå¸‚åœº: HK, US | ç›‘æŽ§æ ‡çš„: 5ä¸ª
â° å½“å‰æ—¶é—´: ä¸åœ¨äº¤æ˜“æ—¶æ®µ
```

## æ€§èƒ½æŒ‡æ ‡

### APIè°ƒç”¨ä¼˜åŒ–

å‡è®¾ç›‘æŽ§åˆ—è¡¨ï¼š3ä¸ªæ¸¯è‚¡ + 2ä¸ªç¾Žè‚¡ = 5ä¸ªæ ‡çš„

| æ—¶æ®µ | ä¹‹å‰ | çŽ°åœ¨ | èŠ‚çœ |
|------|------|------|------|
| æ¸¯è‚¡æ—¶é—´ | 5æ¬¡è°ƒç”¨ | 3æ¬¡è°ƒç”¨ | **40%** |
| ç¾Žè‚¡æ—¶é—´ | 5æ¬¡è°ƒç”¨ | 2æ¬¡è°ƒç”¨ | **60%** |
| éžäº¤æ˜“æ—¶é—´ | 5æ¬¡è°ƒç”¨ | 0æ¬¡è°ƒç”¨ | **100%** |

**æ¯æ—¥èŠ‚çœï¼š**
- æ¸¯è‚¡äº¤æ˜“: 4.5å°æ—¶ Ã— 60æ¬¡/å°æ—¶ Ã— 2æ¬¡èŠ‚çœ = **540æ¬¡è°ƒç”¨**
- ç¾Žè‚¡äº¤æ˜“: 6.5å°æ—¶ Ã— 60æ¬¡/å°æ—¶ Ã— 3æ¬¡èŠ‚çœ = **1170æ¬¡è°ƒç”¨**
- **æ€»è®¡æ¯æ—¥èŠ‚çœ: ~1710æ¬¡APIè°ƒç”¨**

## æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºå¤„ç†**ï¼šç³»ç»Ÿä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼Œç¡®ä¿æœåŠ¡å™¨æ—¶åŒºæ­£ç¡®
2. **å¤ä»¤æ—¶**ï¼šç¾Žè‚¡å¤ä»¤æ—¶/å†¬ä»¤æ—¶çš„äº¤æ˜“æ—¶é—´å¯èƒ½éœ€è¦è°ƒæ•´
3. **å‡æœŸå¤„ç†**ï¼šå½“å‰ä¸æ£€æµ‹å¸‚åœºå‡æœŸï¼Œå‡æœŸæ—¶æ®µå¯èƒ½å°è¯•äº¤æ˜“
4. **ç›˜å‰ç›˜åŽ**ï¼šå½“å‰ä¸æ”¯æŒç›˜å‰ç›˜åŽäº¤æ˜“
5. **è·¨æ—¥å¤„ç†**ï¼šç¾Žè‚¡äº¤æ˜“è·¨è¶Šé›¶ç‚¹ï¼Œå·²æ­£ç¡®å¤„ç†

## æœªæ¥å¢žå¼º

å¯èƒ½çš„æ”¹è¿›ï¼š

1. **å‡æœŸæ—¥åŽ†**ï¼šé›†æˆå¸‚åœºå‡æœŸä¿¡æ¯ï¼Œè‡ªåŠ¨è·³è¿‡ä¼‘å¸‚æ—¥
2. **ç›˜å‰ç›˜åŽ**ï¼šæ”¯æŒç›˜å‰ç›˜åŽäº¤æ˜“æ—¶æ®µ
3. **åŠ¨æ€æ—¶åŒº**ï¼šæ ¹æ®å¤ä»¤æ—¶è‡ªåŠ¨è°ƒæ•´äº¤æ˜“æ—¶é—´
4. **å¸‚åœºçŠ¶æ€API**ï¼šé€šè¿‡APIå®žæ—¶èŽ·å–å¸‚åœºå¼€ç›˜çŠ¶æ€
5. **å¤šæ—¶åŒºæ”¯æŒ**ï¼šæ”¯æŒåœ¨ä¸åŒæ—¶åŒºè¿è¡Œ

## ç›¸å…³æ–‡ä»¶

- `scripts/advanced_technical_trading.py` - ä¸»äº¤æ˜“ç³»ç»Ÿ
- `configs/watchlist.yml` - ç›‘æŽ§æ ‡çš„é…ç½®
- `docs/ADVANCED_STRATEGY_GUIDE.md` - ç­–ç•¥è¯¦ç»†è¯´æ˜Ž
- `docs/SLACK_NOTIFICATION.md` - Slacké€šçŸ¥é…ç½®

## æ€»ç»“

å¸‚åœºæ„ŸçŸ¥åŠŸèƒ½è®©äº¤æ˜“ç³»ç»Ÿæ›´åŠ æ™ºèƒ½å’Œé«˜æ•ˆï¼š

âœ… **æ™ºèƒ½** - è‡ªåŠ¨è¯†åˆ«æ´»è·ƒå¸‚åœº
âœ… **é«˜æ•ˆ** - å‡å°‘40-60%çš„APIè°ƒç”¨
âœ… **å‡†ç¡®** - åªç”¨å®žæ—¶æ•°æ®åšå†³ç­–
âœ… **çµæ´»** - æ˜“äºŽæ‰©å±•æ–°å¸‚åœº

è¿™æ˜¯é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ä¼˜åŒ–ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„ä¸“ä¸šæ€§å’Œå®žç”¨æ€§ã€‚