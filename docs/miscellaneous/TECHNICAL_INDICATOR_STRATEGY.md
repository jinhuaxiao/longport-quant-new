# 技术指标自动交易系统使用指南

## 📊 概述

基于 **RSI（相对强弱指标）** 和 **布林带（Bollinger Bands）** 的组合策略，实现自动化股票交易。

---

## 🎯 策略原理

### **使用的技术指标**

#### 1. **RSI (Relative Strength Index)**
- **周期**: 14天
- **超卖阈值**: 30
- **超买阈值**: 70
- **含义**:
  - RSI < 30：超卖区域，价格可能被低估，反弹概率高
  - RSI > 70：超买区域，价格可能被高估，回调概率高
  - 30-70：中性区域

#### 2. **布林带 (Bollinger Bands)**
- **周期**: 20天
- **标准差**: 2σ
- **组成**:
  - 上轨 = SMA(20) + 2×STD
  - 中轨 = SMA(20)
  - 下轨 = SMA(20) - 2×STD
- **含义**:
  - 价格触及下轨：可能超卖，反弹机会
  - 价格触及上轨：可能超买，回调风险
  - 布林带收窄：波动率降低，可能突破

---

## 📈 交易信号

### **买入信号分级**

#### 🔴 强买入 (90%强度)
- **条件**:
  1. RSI < 30 (超卖)
  2. 价格 ≤ 布林带下轨 × 1.02 (触及或突破下轨)
- **逻辑**: 双重超卖信号，反弹概率极高
- **示例**:
  ```
  股票: 09988.HK
  当前价格: $140.50
  RSI: 28.5
  布林带下轨: $138.00
  → 强买入信号！
  ```

#### 🟡 买入 (70%强度)
- **条件**:
  1. RSI < 40 (接近超卖)
  2. 价格 ≤ 布林带下轨 × 1.05 (接近下轨)
- **逻辑**: 价格处于相对低位，有反弹空间
- **示例**:
  ```
  股票: AAPL.US
  当前价格: $175.20
  RSI: 38.2
  布林带下轨: $170.00
  → 买入信号
  ```

#### 🟢 买入 (60%强度)
- **条件**:
  1. RSI 40-50 (中性)
  2. 价格在布林带下半部 (<30%)
  3. 布林带宽度 < 15% (布林带收窄)
- **逻辑**: 布林带收窄后可能突破，提前布局
- **示例**:
  ```
  股票: MSFT.US
  当前价格: $420.00
  RSI: 45.0
  布林带位置: 25% (下半部)
  布林带宽度: 12% (收窄)
  → 买入信号 (可能突破)
  ```

---

## ⚙️ 系统配置

### **交易参数**

```python
# 在 technical_indicator_trading.py 中修改
class TechnicalIndicatorTrader:
    def __init__(self):
        # 资金管理
        self.budget_per_stock = 5000      # 每只股票预算（港币/美元）
        self.max_positions = 5            # 最大持仓数量

        # 技术指标参数
        self.rsi_period = 14              # RSI周期
        self.rsi_oversold = 30            # RSI超卖阈值
        self.rsi_overbought = 70          # RSI超买阈值
        self.bb_period = 20               # 布林带周期
        self.bb_std = 2.0                 # 布林带标准差
        self.min_history_days = 50        # 最少历史数据天数
```

### **监控股票列表**

编辑 `configs/watchlist.yml`:

```yaml
markets:
  hk:
    - 09988.HK  # 阿里巴巴
    - 03690.HK  # 美团
    - 01810.HK  # 小米
  us:
    - AAPL.US   # 苹果
    - MSFT.US   # 微软
    - NVDA.US   # 英伟达

symbols: []
```

---

## 🚀 使用方法

### **启动交易系统**

```bash
python3 scripts/technical_indicator_trading.py
```

### **系统运行逻辑**

1. **每60秒一轮循环**
2. **检查交易时段**
   - 港股: 9:30-12:00, 13:00-16:00
   - 美股: 21:30-次日4:00 (北京时间)
3. **获取实时行情**
4. **查询账户余额和持仓**
5. **对每个标的进行技术分析**:
   - 获取历史K线数据（至少50天）
   - 计算RSI和布林带
   - 根据策略规则生成交易信号
6. **执行订单**（如果有信号）
7. **记录已交易标的**（每天每只股票最多交易1次）

---

## 📊 实际运行示例

### **启动输出**

```
╔═══════════════════════════════════════════════════════════════╗
║       技术指标自动交易系统 - RSI + 布林带组合策略             ║
╚═══════════════════════════════════════════════════════════════╝

2025-09-30 11:07:45 | INFO - 初始化技术指标交易系统（RSI + 布林带组合策略）
2025-09-30 11:07:45 | INFO - 启动技术指标自动交易系统
2025-09-30 11:07:45 | INFO - 策略：RSI(14) + 布林带(20, 2.0σ)
2025-09-30 11:07:51 | INFO - ✅ 监控 5 个标的: ['09988.HK', '03690.HK', '01810.HK', 'AAPL.US', 'MSFT.US']

📈 账户状态:
  💰 HKD 余额: $100,000.00
  💰 USD 余额: $50,000.00
  📦 持仓数: 2/5
    - 09988.HK: 100股 @ $145.00
    - AAPL.US: 50股 @ $180.00
```

### **交易时段扫描**

```
============================================================
第 1 轮扫描 - 14:35:22
============================================================
📊 获取到 5 个标的的实时行情

🎯 03690.HK 生成交易信号:
   类型: STRONG_BUY
   强度: 90.0%
   价格: $102.30
   RSI: 28.5
   布林带位置: 15.2%
   原因: RSI超卖(28.5) + 触及布林带下轨

💰 检查资金: 需要 $5,010.00, 可用 $95,000.00 ✅

✅ 订单已提交: 987654321
   标的: 03690.HK
   类型: STRONG_BUY
   数量: 48股
   价格: $102.30
   总额: $4,910.40
   RSI: 28.5
   布林带位置: 15.2%

💤 本轮扫描完成
⏳ 等待60秒进入下一轮...
```

### **非交易时段**

```
============================================================
第 2 轮扫描 - 17:05:15
============================================================
⏰ 当前时间: 不在交易时段
⏳ 等待60秒进入下一轮...
```

---

## 🔧 风控机制

### **交易限制**

1. **持仓限制**: 最多持有5只股票
2. **单票预算**: 每只股票最多投入$5,000
3. **重复交易限制**: 每只股票每天最多交易1次
4. **数据要求**: 至少需要50天历史数据才能分析

### **资金检查**

```python
# 系统会自动检查
required_cash = price × quantity
available_cash = account["cash"][currency]

if required_cash > available_cash:
    logger.warning("资金不足，跳过")
    return
```

### **持仓检查**

```python
# 避免重复持仓
if symbol in account["positions"]:
    logger.debug("已持有，跳过")
    return

# 避免超过持仓上限
if account["position_count"] >= self.max_positions:
    logger.debug("持仓已满，跳过")
    return
```

---

## 📉 策略优化建议

### **调整RSI参数**

```python
# 更激进的策略（更多交易信号）
self.rsi_oversold = 35  # 从30提高到35
self.rsi_overbought = 65  # 从70降低到65

# 更保守的策略（更少但更可靠的信号）
self.rsi_oversold = 25  # 从30降低到25
self.rsi_overbought = 75  # 从70提高到75
```

### **调整布林带参数**

```python
# 更宽的布林带（更少触及上下轨）
self.bb_std = 2.5  # 从2.0提高到2.5

# 更窄的布林带（更频繁触及上下轨）
self.bb_std = 1.5  # 从2.0降低到1.5
```

### **调整预算分配**

```python
# 增加单票投入
self.budget_per_stock = 10000  # 从5000增加到10000

# 减少持仓数量，集中投资
self.max_positions = 3  # 从5减少到3
```

---

## 🧪 回测建议

在实盘运行前，建议先进行历史回测：

```bash
# 使用历史数据回测策略
python3 scripts/run_backtest.py \
  --strategy technical_indicator \
  --start-date 2024-01-01 \
  --end-date 2024-12-31 \
  --symbols 09988.HK,AAPL.US
```

---

## 📚 技术指标详解

### **RSI计算公式**

```
RS = 平均上涨幅度 / 平均下跌幅度
RSI = 100 - (100 / (1 + RS))
```

### **布林带计算公式**

```
中轨 (Middle Band) = SMA(20)
上轨 (Upper Band) = 中轨 + 2×STD(20)
下轨 (Lower Band) = 中轨 - 2×STD(20)
```

### **布林带位置百分比**

```
位置% = (当前价格 - 下轨) / (上轨 - 下轨) × 100

0%: 在下轨
50%: 在中轨
100%: 在上轨
```

---

## ⚠️ 注意事项

1. **历史数据不足**: 如果某个标的没有足够的历史数据（<50天），系统会跳过分析
2. **非交易时段**: 港股和美股有不同的交易时间，系统会自动检测
3. **资金不足**: 如果账户余额不足以购买1股，系统会跳过该标的
4. **持仓上限**: 达到持仓上限后，不会生成新的买入信号
5. **API限流**: 获取历史K线数据时，系统会自动处理API限流

---

## 📞 技术支持

如需帮助或有任何问题，请查看：

- **系统日志**: 查看详细的运行日志
- **配置文件**: `configs/watchlist.yml`
- **策略代码**: `scripts/technical_indicator_trading.py`
- **技术指标库**: `src/longport_quant/features/technical_indicators.py`

---

## 🎓 学习资源

### **推荐阅读**

- RSI指标详解：https://www.investopedia.com/terms/r/rsi.asp
- 布林带详解：https://www.investopedia.com/terms/b/bollingerbands.asp
- 长桥OpenAPI文档：https://open.longportapp.com/zh-CN/docs

### **策略优化方向**

1. **增加MACD指标**：结合MACD金叉死叉
2. **增加成交量分析**：确认突破有效性
3. **增加趋势过滤**：只在上升趋势中买入
4. **动态止损止盈**：基于ATR设置止损位

---

**祝交易顺利！** 🚀