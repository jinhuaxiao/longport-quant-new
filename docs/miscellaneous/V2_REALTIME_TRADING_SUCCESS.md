# å®æ—¶è®¢é˜…äº¤æ˜“ç³»ç»ŸV2 - æˆåŠŸéƒ¨ç½²

## ä¿®å¤å®Œæˆ âœ…

æˆåŠŸä¿®å¤äº†å›è°ƒå‡½æ•°çš„äº‹ä»¶å¾ªç¯é—®é¢˜ï¼Œç³»ç»Ÿç°å·²æ­£å¸¸è¿è¡Œã€‚

## å…³é”®ä¿®å¤

### é—®é¢˜
å›è°ƒå‡½æ•°åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­è¿è¡Œï¼Œå°è¯•ä½¿ç”¨`asyncio.create_task()`æ—¶æŠ¥é”™ï¼š
- `RuntimeWarning: coroutine 'on_quote_update' was never awaited`
- `RuntimeError: no running event loop`

### è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨`asyncio.run_coroutine_threadsafe()`å®‰å…¨åœ°å°†å¼‚æ­¥ä»»åŠ¡è°ƒåº¦åˆ°ä¸»äº‹ä»¶å¾ªç¯ï¼š

```python
def on_quote_update(self, symbol: str, event: openapi.PushQuote):
    """åŒæ­¥å›è°ƒå‡½æ•°ï¼Œå®‰å…¨è°ƒåº¦åˆ°ä¸»å¾ªç¯"""
    try:
        if self.main_loop and not self.main_loop.is_closed():
            asyncio.run_coroutine_threadsafe(
                self._handle_quote_update(symbol, event),
                self.main_loop
            )
    except Exception as e:
        logger.error(f"è°ƒåº¦è¡Œæƒ…å¤„ç†ä»»åŠ¡å¤±è´¥ {symbol}: {e}")
```

## æµ‹è¯•ç»“æœ

### æˆåŠŸè¿è¡Œè¾“å‡º
```
ğŸš€ åˆå§‹åŒ–å¢å¼ºç‰ˆäº¤æ˜“ç­–ç•¥ V2.0
   ç­–ç•¥æ¨¡å¼: HYBRID
   â€¢ å®æ—¶è®¢é˜…æ¨¡å¼
   â€¢ å¸‚åœºæ—¶é—´åˆ¤æ–­
   â€¢ é€†åŠ¿ä¹°å…¥: RSIè¶…å– + å¸ƒæ—å¸¦ä¸‹è½¨
   â€¢ çªç ´ä¹°å…¥: ä»·æ ¼çªç ´ + æˆäº¤é‡ç¡®è®¤

ğŸ“¡ è®¢é˜…å®æ—¶è¡Œæƒ…: 22ä¸ªæ ‡çš„...
âœ… æˆåŠŸè®¢é˜… 22 ä¸ªæ ‡çš„çš„å®æ—¶è¡Œæƒ…

ğŸ“Š [ç¾è‚¡ç›˜å‰] MSFT.US(å¾®è½¯): WEAK BREAKOUT ä¿¡å· (è¯„åˆ†:35)
ğŸ“Š [ç¾è‚¡ç›˜å‰] AMD.US(AMD): NORMAL BREAKOUT ä¿¡å· (è¯„åˆ†:50)
ğŸ“Š [ç¾è‚¡ç›˜å‰] GOOGL.US(è°·æ­Œ): WEAK REVERSAL ä¿¡å· (è¯„åˆ†:30)
ğŸ“Š [ç¾è‚¡ç›˜å‰] NVDA.US(è‹±ä¼Ÿè¾¾): STRONG BREAKOUT ä¿¡å· (è¯„åˆ†:57)

ğŸ“Œ å¤„ç†ä¹°å…¥ä¿¡å·: AMD.US, è¯„åˆ†=50, å¸‚åœº=ç¾è‚¡ç›˜å‰
```

## æ ¸å¿ƒåŠŸèƒ½ç¡®è®¤

1. **å®æ—¶è®¢é˜…æ¨¡å¼** âœ…
   - æˆåŠŸè®¢é˜…22ä¸ªæ ‡çš„
   - å®æ—¶æ¥æ”¶è¡Œæƒ…æ¨é€
   - å¼‚æ­¥å¤„ç†ä¿¡å·

2. **å¸‚åœºæ—¶é—´åˆ¤æ–­** âœ…
   - æ­£ç¡®è¯†åˆ«ç¾è‚¡ç›˜å‰æ—¶é—´
   - æ­£ç¡®è¯†åˆ«æ¸¯è‚¡äº¤æ˜“æ—¶é—´
   - æ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´ä»“ä½

3. **ä¼˜å…ˆçº§é˜Ÿåˆ—ç³»ç»Ÿ** âœ…
   - æ­¢æŸä¿¡å·æœ€é«˜ä¼˜å…ˆçº§ (-100)
   - æ­¢ç›ˆä¿¡å·æ¬¡é«˜ä¼˜å…ˆçº§ (-90)
   - ä¹°å…¥ä¿¡å·æŒ‰è¯„åˆ†æ’åº

4. **åŒç­–ç•¥ç³»ç»Ÿ** âœ…
   - REVERSAL: é€†åŠ¿ç­–ç•¥
   - BREAKOUT: çªç ´ç­–ç•¥
   - HYBRID: æ··åˆç­–ç•¥

## è¿è¡Œå‘½ä»¤

### æµ‹è¯•æ¨¡å¼
```bash
# æ¨¡æ‹Ÿæ¨¡å¼ï¼Œä¸å‘é€Slacké€šçŸ¥
python scripts/momentum_breakthrough_trading.py --builtin --dry-run --no-slack

# æ¨¡æ‹Ÿæ¨¡å¼ï¼Œå¯ç”¨Slacké€šçŸ¥
python scripts/momentum_breakthrough_trading.py --builtin --dry-run
```

### å®ç›˜æ¨¡å¼
```bash
# æ··åˆç­–ç•¥ï¼ˆé»˜è®¤ï¼‰
python scripts/momentum_breakthrough_trading.py --builtin --mode HYBRID

# çº¯çªç ´ç­–ç•¥
python scripts/momentum_breakthrough_trading.py --builtin --mode BREAKOUT

# çº¯é€†åŠ¿ç­–ç•¥
python scripts/momentum_breakthrough_trading.py --builtin --mode REVERSAL
```

## ä¸V1ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | V1 (è½®è¯¢) | V2 (è®¢é˜…) |
|------|-----------|-----------|
| å“åº”å»¶è¿Ÿ | 0-60ç§’ | <100ms |
| APIæ•ˆç‡ | ä½ï¼ˆé¢‘ç¹è°ƒç”¨ï¼‰ | é«˜ï¼ˆæ¨é€æ¨¡å¼ï¼‰ |
| èµ„æºæ¶ˆè€— | é«˜ï¼ˆå‘¨æœŸæ€§å³°å€¼ï¼‰ | ä½ï¼ˆå¹³ç¨³ï¼‰ |
| ä¿¡å·å¤„ç† | ä¸²è¡Œ | å¹¶è¡Œï¼ˆå¼‚æ­¥ï¼‰ |
| å¸‚åœºæ—¶é—´ | âŒ | âœ… |
| ä¼˜å…ˆçº§é˜Ÿåˆ— | âŒ | âœ… |

## æ¶æ„ä¼˜åŠ¿

1. **äº‹ä»¶é©±åŠ¨**
   - åŸºäºæ¨é€è€Œéè½®è¯¢
   - å®æ—¶å“åº”å¸‚åœºå˜åŒ–

2. **çº¿ç¨‹å®‰å…¨**
   - ä½¿ç”¨`run_coroutine_threadsafe`
   - å›è°ƒä¸ä¸»å¾ªç¯æ­£ç¡®åŒæ­¥

3. **æ™ºèƒ½è°ƒåº¦**
   - ä¼˜å…ˆçº§é˜Ÿåˆ—å¤„ç†
   - é¿å…è¿‡åº¦åˆ†æï¼ˆ30ç§’é—´éš”ï¼‰

4. **å¸‚åœºæ„ŸçŸ¥**
   - åŒºåˆ†æ¸¯è‚¡/ç¾è‚¡äº¤æ˜“æ—¶é—´
   - ç›˜å‰ç›˜åè‡ªåŠ¨è°ƒæ•´ä»“ä½

## ç›‘æ§è¦ç‚¹

- è®¢é˜…è¿æ¥çŠ¶æ€
- ä¿¡å·é˜Ÿåˆ—é•¿åº¦
- å¤„ç†å»¶è¿Ÿç»Ÿè®¡
- å„ç­–ç•¥ä¿¡å·åˆ†å¸ƒ

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. æ·»åŠ æ›´å¤šæŠ€æœ¯æŒ‡æ ‡
2. ä¼˜åŒ–ä¿¡å·è¯„åˆ†ç®—æ³•
3. å¢åŠ è‡ªé€‚åº”æ­¢æŸæœºåˆ¶
4. æ·»åŠ æ›´è¯¦ç»†çš„æ€§èƒ½ç›‘æ§

---

ç³»ç»Ÿå·²æˆåŠŸå‡çº§åˆ°V2å®æ—¶è®¢é˜…æ¨¡å¼ï¼Œæ˜¾è‘—æå‡äº†å“åº”é€Ÿåº¦å’Œæ‰§è¡Œæ•ˆç‡ã€‚