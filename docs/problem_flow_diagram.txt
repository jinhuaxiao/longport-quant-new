================================================================================
1398.HKä¿¡å·ä¸¢å¤± - å®Œæ•´é—®é¢˜æµç¨‹å›¾
================================================================================

æ—¶é—´æµ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

13:44:42
  â”œâ”€ order_executor æ¶ˆè´¹ä¿¡å·: 1398.HK (BUY, score=59)
  â”‚  â””â”€ å¼€å§‹æ‰§è¡Œä¹°å…¥æ“ä½œ
  â”‚
  â””â”€ 13:44:43 âš ï¸ èµ„é‡‘ä¸è¶³
     â”œâ”€ è°ƒç”¨ requeue_with_delay(delay=3åˆ†é’Ÿ)
     â”‚  â””â”€ signal['retry_after'] = 13:47:43
     â””â”€ ä¿¡å·é‡æ–°å…¥é˜Ÿï¼Œç­‰å¾…é‡è¯•


13:47:44
  â”œâ”€ order_executor é‡è¯•æ¶ˆè´¹: 1398.HK (ä¼˜å…ˆçº§é™ä½åˆ°39)
  â”‚  â””â”€ å†æ¬¡å°è¯•ä¹°å…¥
  â”‚
  â””â”€ âš ï¸ èµ„é‡‘ä»ä¸è¶³
     â”œâ”€ è°ƒç”¨ requeue_with_delay(delay=4åˆ†é’Ÿ)
     â”‚  â””â”€ signal['retry_after'] = 13:51:44
     â””â”€ ä¿¡å·é‡æ–°å…¥é˜Ÿï¼Œç»§ç»­ç­‰å¾…


13:51:46
  â”œâ”€ order_executor ç¬¬ä¸‰æ¬¡é‡è¯•: 1398.HK
  â”‚  â””â”€ å†æ¬¡å°è¯•ä¹°å…¥
  â”‚
  â””â”€ âš ï¸ èµ„é‡‘ä»ä¸è¶³
     â”œâ”€ è°ƒç”¨ requeue_with_delay(delay=5åˆ†é’Ÿ)
     â”‚  â””â”€ signal['retry_after'] = 13:56:46
     â””â”€ ä¿¡å·é‡æ–°å…¥é˜Ÿï¼Œç»§ç»­ç­‰å¾…


â”€â”€ [å…³é”®æ—¶é—´ç‚¹] â”€â”€

13:56:22 â”€â”€â”€ signal_generator ç”Ÿæˆæ–°ä¿¡å·
  â”œâ”€ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ (RSI=69.7, MACDå¤šå¤´, ä¸Šå‡è¶‹åŠ¿)
  â”œâ”€ è¯„åˆ†: 59/100 âœ“ (å¥½ä¿¡å·ï¼Œè¿œè¶…30åˆ†é˜ˆå€¼)
  â”œâ”€ æ£€æŸ¥: await signal_queue.has_pending_signal('1398.HK', 'BUY')
  â”‚
  â””â”€ has_pending_signal() æ‰§è¡Œ:
     â”œâ”€ éå†ä¸»é˜Ÿåˆ—
     â”œâ”€ æ‰¾åˆ° 1398.HK çš„ä¿¡å·ï¼ˆå»¶è¿Ÿä¿¡å·ï¼ï¼‰
     â”œâ”€ âŒ ä¸æ£€æŸ¥ retry_afterï¼Œç›´æ¥è¿”å› True
     â”‚
     â””â”€ signal_generator æ”¶åˆ° True:
        â”œâ”€ è®°å½•: "â­ï¸ 1398.HK: è·³è¿‡ä¿¡å· - é˜Ÿåˆ—ä¸­å·²æœ‰è¯¥æ ‡çš„çš„å¾…å¤„ç†ä¿¡å·"
        â”œâ”€ æ–°ä¿¡å·è¢«ä¸¢å¼ƒ
        â””â”€ âŒ ä¼˜è´¨ä¿¡å·æ°¸ä¹…ä¸¢å¤±


13:56:46 â”€â”€â”€ å»¶è¿Ÿä¿¡å·çš„ retry_after åˆ°æœŸ
  â””â”€ order_executor å¯ä»¥å¤„ç†å»¶è¿Ÿä¿¡å·äº†ï¼ˆä½†æ­¤æ—¶å¤ªæ™šï¼‰


13:56:51
  â”œâ”€ order_executor ç¬¬å››æ¬¡æ¶ˆè´¹: 1398.HK
  â”‚  â””â”€ æœ€åä¸€æ¬¡å°è¯•
  â”‚
  â””â”€ âš ï¸ èµ„é‡‘ä»ä¸è¶³ï¼Œè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°(5)
     â”œâ”€ æ ‡è®°ä¿¡å·å®Œæˆ
     â””â”€ æ”¾å¼ƒå¤„ç†ï¼ŒæŸå¤±è¿™ç¬”äº¤æ˜“


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä»£ç å±‚é¢çš„é—®é¢˜:

has_pending_signal() çš„ç¼ºé™·:

â”Œâ”€ signal_queue.py (ç¬¬638-672è¡Œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               â”‚
â”‚  async def has_pending_signal(self, symbol: str, signal_type: str = None):  â”‚
â”‚      # æ£€æŸ¥ä¸»é˜Ÿåˆ—                                                             â”‚
â”‚      main_signals = await redis.zrange(self.queue_key, 0, -1)               â”‚
â”‚      for signal_json in main_signals:                                        â”‚
â”‚          signal = self._deserialize_signal(signal_json)                      â”‚
â”‚          if signal.get('symbol') == symbol:                                  â”‚
â”‚              if signal_type is None or signal.get('type') == signal_type:    â”‚
â”‚                  return True  # âŒ å…³é”®é—®é¢˜ï¼šä¸æ£€æŸ¥ä¿¡å·çŠ¶æ€                    â”‚
â”‚                                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  é—®é¢˜åˆ†æ:                                                                    â”‚
â”‚  â”œâ”€ å½“æ—¶é˜Ÿåˆ—ä¸­çš„1398.HKä¿¡å·çŠ¶æ€:                                             â”‚
â”‚  â”‚  {                                                                        â”‚
â”‚  â”‚    'symbol': '1398.HK',                                                  â”‚
â”‚  â”‚    'type': 'BUY',                                                        â”‚
â”‚  â”‚    'retry_after': 1730540206  # 13:56:46 çš„æ—¶é—´æˆ³                       â”‚
â”‚  â”‚    # è¿˜æœ‰ 12 ç§’æ²¡åˆ°æœŸ                                                     â”‚
â”‚  â”‚  }                                                                        â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â”œâ”€ has_pending_signal() çš„è¿”å›:                                            â”‚
â”‚  â”‚  â”œâ”€ æ‰¾åˆ°symbol='1398.HK'çš„ä¿¡å· âœ“                                         â”‚
â”‚  â”‚  â”œâ”€ æ‰¾åˆ°type='BUY'çš„ä¿¡å· âœ“                                              â”‚
â”‚  â”‚  â””â”€ æ²¡æœ‰æ£€æŸ¥ 'retry_after' âŒ                                            â”‚
â”‚  â”‚      â†’ è¿”å› True                                                          â”‚
â”‚  â”‚                                                                           â”‚
â”‚  â””â”€ signal_generator çš„ååº”:                                               â”‚
â”‚     â””â”€ å“¦ï¼Œé˜Ÿåˆ—ä¸­å·²æœ‰BUYä¿¡å·ï¼Œå¿…é¡»å»é‡ï¼Œä¸¢å¼ƒæ–°ä¿¡å· âŒ                      â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®é™…åº”è¯¥çš„è¡Œä¸º:

â”Œâ”€ ä¿®å¤åçš„ has_pending_signal() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                â”‚
â”‚  async def has_pending_signal(self, symbol, signal_type=None,                â”‚
â”‚                               exclude_delayed=True):  # æ–°å¢å‚æ•°             â”‚
â”‚      redis = await self._get_redis()                                         â”‚
â”‚      current_time = time.time()                                              â”‚
â”‚                                                                               â”‚
â”‚      for signal_json in await redis.zrange(self.queue_key, 0, -1):          â”‚
â”‚          signal = self._deserialize_signal(signal_json)                      â”‚
â”‚          if signal.get('symbol') == symbol:                                  â”‚
â”‚              if signal_type is None or signal.get('type') == signal_type:    â”‚
â”‚                  # ğŸ”¥ æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦å»¶è¿Ÿä¿¡å·ä¸”æœªåˆ°æœŸ                          â”‚
â”‚                  if exclude_delayed and 'retry_after' in signal:            â”‚
â”‚                      if signal['retry_after'] > current_time:                â”‚
â”‚                          continue  # è·³è¿‡æ­¤å»¶è¿Ÿä¿¡å·ï¼Œç»§ç»­æ£€æŸ¥                 â”‚
â”‚                  return True                                                  â”‚
â”‚      return False                                                             â”‚
â”‚                                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  13:56:22 æ—¶çš„æ‰§è¡Œæµç¨‹ï¼ˆä¿®å¤åï¼‰:                                            â”‚
â”‚  â”œâ”€ éå†é˜Ÿåˆ—ï¼Œæ‰¾åˆ°1398.HKçš„BUYä¿¡å· âœ“                                         â”‚
â”‚  â”œâ”€ æ£€æŸ¥ 'retry_after' å­—æ®µ: å­˜åœ¨                                            â”‚
â”‚  â”œâ”€ æ¯”è¾ƒ: 13:56:46 (retry_after) > 13:56:22 (now) ? â†’ True                 â”‚
â”‚  â”œâ”€ åŠ¨ä½œ: è·³è¿‡æ­¤ä¿¡å·ï¼ˆcontinueï¼‰ï¼Œä¸è¿”å›                                      â”‚
â”‚  â”œâ”€ ç»§ç»­æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–éå»¶è¿Ÿçš„1398.HKä¿¡å· â†’ æ²¡æœ‰                            â”‚
â”‚  â””â”€ è¿”å›: False
â”‚     â†’ æ–°ä¿¡å·å¯ä»¥ç”Ÿæˆï¼ âœ“                                                    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å…³é”®å¯¹æ¯”:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯                   â”‚ ä¿®å¤å‰          â”‚ ä¿®å¤å                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é˜Ÿåˆ—ä¸­åªæœ‰å»¶è¿Ÿä¿¡å·     â”‚ è¿”å›True        â”‚ è¿”å›Falseï¼ˆå…è®¸æ–°ä¿¡å·ï¼‰               â”‚
â”‚ é˜Ÿåˆ—ä¸­æœ‰æ­£å¸¸å¾…å¤„ç†ä¿¡å· â”‚ è¿”å›True        â”‚ è¿”å›Trueï¼ˆé˜»æ­¢æ–°ä¿¡å·ï¼‰                â”‚
â”‚ é˜Ÿåˆ—ä¸­æœ‰æ­£å¸¸+å»¶è¿Ÿä¿¡å·  â”‚ è¿”å›True        â”‚ å–å†³äºæ­£å¸¸ä¿¡å·æ˜¯å¦å­˜åœ¨                â”‚
â”‚ é˜Ÿåˆ—ä¸ºç©º               â”‚ è¿”å›False       â”‚ è¿”å›False                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å½±å“èŒƒå›´å¯è§†åŒ–:

  æ—¶é—´è½´ (åˆ†é’Ÿ)
  11:51 â”€â”€â”¬â”€ [O-O-O-O-O-...-O-O] (101ä¸ªä¿¡å·è¢«è·³è¿‡)
  14:00 â”€â”€â”˜
  
  æ ‡çš„åˆ†å¸ƒ:
  [1398.HK] (è¢«è·³è¿‡å¤šæ¬¡)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  [1299.HK] (å‹é‚¦ä¿é™©)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  [3988.HK] (ä¸­å›½é“¶è¡Œ)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  [2318.HK] (ä¸­å›½å¹³å®‰)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  [941.HK]  (ä¸­å›½ç§»åŠ¨)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  [888.HK]  (æµ·æ´‹çŸ³æ²¹)    â–ˆâ–ˆâ–ˆâ–ˆ
  [å…¶ä»–...]               â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  
  ä¿¡å·è¯„åˆ†åˆ†å¸ƒ:
  [30-40]: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (24ä¸ª)
  [40-50]: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (35ä¸ª)
  [50-60]: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (28ä¸ª)
  [60+]:   â–ˆâ–ˆ (14ä¸ª)
  
  æ‰€æœ‰è¢«è·³è¿‡çš„ä¿¡å·è¯„åˆ†éƒ½ >= 30 åˆ†ï¼ˆéƒ½æ˜¯æœ‰æ•ˆçš„äº¤æ˜“ä¿¡å·ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ€»ç»“:

é—®é¢˜: å»é‡é€»è¾‘æ²¡æœ‰åŒºåˆ†"å»¶è¿Ÿç­‰å¾…"å’Œ"çœŸæ­£å¾…å¤„ç†"ä¸¤ç§çŠ¶æ€
åŸå› : has_pending_signal() æ²¡æœ‰æ£€æŸ¥ retry_after å­—æ®µ
åæœ: 101ä¸ªä¼˜è´¨ä¿¡å·è¢«é”™è¯¯ä¸¢å¼ƒï¼ŒæŸå¤±å¤§é‡äº¤æ˜“æœºä¼š
ä¿®å¤: æ·»åŠ  retry_after æ£€æŸ¥ï¼Œæ’é™¤æœªåˆ°æœŸçš„å»¶è¿Ÿä¿¡å·

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
