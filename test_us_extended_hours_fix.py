#!/usr/bin/env python3
"""æµ‹è¯•ç¾Žè‚¡ç›˜å‰ç›˜åŽæ—¶é—´åˆ¤æ–­ä¿®å¤"""

from datetime import datetime, time

def is_us_market_open_old(beijing_time: time) -> bool:
    """ä¿®å¤å‰çš„é€»è¾‘ï¼ˆåªåŒ…å«å¸¸è§„äº¤æ˜“æ—¶é—´ï¼‰"""
    # ç¾Žè‚¡å¸¸è§„äº¤æ˜“ï¼š21:00-æ¬¡æ—¥6:00ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    return beijing_time >= time(21, 0) or beijing_time <= time(6, 0)

def is_us_market_open_new(beijing_time: time) -> bool:
    """ä¿®å¤åŽçš„é€»è¾‘ï¼ˆåŒ…å«ç›˜å‰ã€å¸¸è§„ã€ç›˜åŽï¼‰"""
    # ç¾Žè‚¡ç›˜å‰+å¸¸è§„+ç›˜åŽï¼š16:00-æ¬¡æ—¥10:00ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    return beijing_time >= time(16, 0) or beijing_time <= time(10, 0)

print("=" * 80)
print("ðŸ§ª æµ‹è¯•ç¾Žè‚¡ç›˜å‰ç›˜åŽæ—¶é—´åˆ¤æ–­ä¿®å¤")
print("=" * 80)

print("\nðŸ“Š ç¾Žè‚¡äº¤æ˜“æ—¶æ®µè¯´æ˜Ž:")
print("  ç›˜å‰ï¼ˆPre-Marketï¼‰:  04:00-09:30 ET")
print("  å¸¸è§„ï¼ˆRegularï¼‰:      09:30-16:00 ET")
print("  ç›˜åŽï¼ˆAfter-Hoursï¼‰: 16:00-20:00 ET")

print("\nðŸ• è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆå†¬ä»¤æ—¶ UTC-5ï¼‰:")
print("  ç›˜å‰:  17:00-22:30 åŒ—äº¬æ—¶é—´")
print("  å¸¸è§„:  22:30-05:00 åŒ—äº¬æ—¶é—´ï¼ˆæ¬¡æ—¥ï¼‰")
print("  ç›˜åŽ:  05:00-09:00 åŒ—äº¬æ—¶é—´ï¼ˆæ¬¡æ—¥ï¼‰")

print("\nðŸ• è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆå¤ä»¤æ—¶ UTC-4ï¼‰:")
print("  ç›˜å‰:  16:00-21:30 åŒ—äº¬æ—¶é—´")
print("  å¸¸è§„:  21:30-04:00 åŒ—äº¬æ—¶é—´ï¼ˆæ¬¡æ—¥ï¼‰")
print("  ç›˜åŽ:  04:00-08:00 åŒ—äº¬æ—¶é—´ï¼ˆæ¬¡æ—¥ï¼‰")

print("\nðŸ’¡ ä¿®å¤æ–¹æ¡ˆ:")
print("  ä½¿ç”¨ä¿å®ˆèŒƒå›´: 16:00-æ¬¡æ—¥10:00 åŒ—äº¬æ—¶é—´")
print("  è¦†ç›–å¤ä»¤æ—¶å’Œå†¬ä»¤æ—¶çš„æ‰€æœ‰äº¤æ˜“æ—¶æ®µ")

# æµ‹è¯•ç”¨ä¾‹ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
test_cases = [
    # (æ—¶é—´, æ˜¯å¦åº”è¯¥å¼€ç›˜, è¯´æ˜Ž)
    (time(15, 0), False, "ç¾Žè‚¡ä¼‘å¸‚"),
    (time(15, 59), False, "ç¾Žè‚¡ä¼‘å¸‚"),
    (time(16, 0), True, "ç›˜å‰å¼€å§‹ï¼ˆå¤ä»¤æ—¶ï¼‰"),
    (time(17, 0), True, "ç›˜å‰å¼€å§‹ï¼ˆå†¬ä»¤æ—¶ï¼‰"),
    (time(17, 26), True, "ç›˜å‰äº¤æ˜“ä¸­ï¼ˆç”¨æˆ·åé¦ˆæ—¶é—´ï¼‰"),
    (time(18, 0), True, "ç›˜å‰äº¤æ˜“ä¸­"),
    (time(20, 0), True, "ç›˜å‰äº¤æ˜“ä¸­"),
    (time(21, 30), True, "ç›˜å‰ç»“æŸï¼ˆå¤ä»¤æ—¶ï¼‰å¸¸è§„å¼€å§‹"),
    (time(22, 0), True, "å¸¸è§„äº¤æ˜“ä¸­"),
    (time(22, 30), True, "ç›˜å‰ç»“æŸï¼ˆå†¬ä»¤æ—¶ï¼‰å¸¸è§„å¼€å§‹"),
    (time(23, 0), True, "å¸¸è§„äº¤æ˜“ä¸­"),
    (time(0, 0), True, "å¸¸è§„äº¤æ˜“ä¸­ï¼ˆæ¬¡æ—¥ï¼‰"),
    (time(2, 0), True, "å¸¸è§„äº¤æ˜“ä¸­ï¼ˆæ¬¡æ—¥ï¼‰"),
    (time(4, 0), True, "å¸¸è§„ç»“æŸï¼ˆå¤ä»¤æ—¶ï¼‰ç›˜åŽå¼€å§‹"),
    (time(5, 0), True, "å¸¸è§„ç»“æŸï¼ˆå†¬ä»¤æ—¶ï¼‰ç›˜åŽå¼€å§‹"),
    (time(6, 0), True, "ç›˜åŽäº¤æ˜“ä¸­"),
    (time(8, 0), True, "ç›˜åŽç»“æŸï¼ˆå¤ä»¤æ—¶ï¼‰"),
    (time(9, 0), True, "ç›˜åŽç»“æŸï¼ˆå†¬ä»¤æ—¶ï¼‰"),
    (time(10, 0), True, "ä¿å®ˆä¸Šé™ï¼ˆåŒ…å«ï¼‰"),
    (time(10, 1), False, "ç¾Žè‚¡ä¼‘å¸‚"),
    (time(12, 0), False, "ç¾Žè‚¡ä¼‘å¸‚"),
    (time(14, 0), False, "ç¾Žè‚¡ä¼‘å¸‚"),
]

print(f"\nðŸ“‹ æµ‹è¯•ç»“æžœå¯¹æ¯”:")
print(f"{'åŒ—äº¬æ—¶é—´':<12} {'é¢„æœŸ':<8} {'ä¿®å¤å‰':<8} {'ä¿®å¤åŽ':<8} {'ä¿®å¤å‰çŠ¶æ€':<15} {'ä¿®å¤åŽçŠ¶æ€':<15} {'è¯´æ˜Ž':<30}")
print("-" * 115)

errors_old = 0
errors_new = 0

for test_time, expected, description in test_cases:
    result_old = is_us_market_open_old(test_time)
    result_new = is_us_market_open_new(test_time)

    status_old = "âœ… æ­£ç¡®" if result_old == expected else "âŒ é”™è¯¯"
    status_new = "âœ… æ­£ç¡®" if result_new == expected else "âŒ é”™è¯¯"

    if result_old != expected:
        errors_old += 1
    if result_new != expected:
        errors_new += 1

    time_str = test_time.strftime("%H:%M")
    expected_str = "å¼€ç›˜" if expected else "ä¼‘å¸‚"
    old_str = "å¼€ç›˜" if result_old else "ä¼‘å¸‚"
    new_str = "å¼€ç›˜" if result_new else "ä¼‘å¸‚"

    print(f"{time_str:<12} {expected_str:<8} {old_str:<8} {new_str:<8} {status_old:<15} {status_new:<15} {description:<30}")

print("\n" + "=" * 80)
print("ðŸ“Š ç»Ÿè®¡ç»“æžœ")
print("=" * 80)

print(f"\næ€»æµ‹è¯•ç”¨ä¾‹: {len(test_cases)}")

print(f"\nä¿®å¤å‰ï¼ˆåªåŒ…å«å¸¸è§„äº¤æ˜“æ—¶é—´ï¼‰:")
print(f"  âŒ é”™è¯¯: {errors_old}/{len(test_cases)}")
print(f"  âœ… æ­£ç¡®: {len(test_cases) - errors_old}/{len(test_cases)}")
print(f"  å‡†ç¡®çŽ‡: {(len(test_cases) - errors_old)/len(test_cases)*100:.1f}%")

print(f"\nä¿®å¤åŽï¼ˆåŒ…å«ç›˜å‰+å¸¸è§„+ç›˜åŽï¼‰:")
print(f"  âŒ é”™è¯¯: {errors_new}/{len(test_cases)}")
print(f"  âœ… æ­£ç¡®: {len(test_cases) - errors_new}/{len(test_cases)}")
print(f"  å‡†ç¡®çŽ‡: {(len(test_cases) - errors_new)/len(test_cases)*100:.1f}%")

print("\n" + "=" * 80)
print("ðŸŽ¯ å…³é”®ä¿®å¤")
print("=" * 80)

print("\n**é—®é¢˜æ ¹æº**:")
print("  ä¿®å¤å‰: åªåˆ¤æ–­å¸¸è§„äº¤æ˜“æ—¶é—´ï¼ˆ21:00-æ¬¡æ—¥06:00 åŒ—äº¬æ—¶é—´ï¼‰")
print("  ä¿®å¤åŽ: åŒ…å«ç›˜å‰+å¸¸è§„+ç›˜åŽï¼ˆ16:00-æ¬¡æ—¥10:00 åŒ—äº¬æ—¶é—´ï¼‰")

print("\n**å½±å“èŒƒå›´**:")
print("  ç›˜å‰æ—¶æ®µï¼ˆ16:00-21:00/22:30ï¼‰è¢«é”™è¯¯åˆ¤æ–­ä¸ºä¼‘å¸‚")
print("  ç›˜åŽæ—¶æ®µï¼ˆ04:00/05:00-10:00ï¼‰è¢«éƒ¨åˆ†é”™è¯¯åˆ¤æ–­ä¸ºä¼‘å¸‚")
print("  å¯¼è‡´å®žæ—¶æŒªä»“å’Œç´§æ€¥å–å‡ºæ£€æŸ¥è¢«è·³è¿‡")

print("\n**ç”¨æˆ·åé¦ˆæ¡ˆä¾‹**:")
print("  æ—¶é—´: åŒ—äº¬æ—¶é—´17:26ï¼ˆç¾Žä¸œæ—¶é—´04:26ï¼Œç›˜å‰ï¼‰")
print("  ä¿®å¤å‰: åˆ¤æ–­ä¸ºä¼‘å¸‚ âŒ")
print("  ä¿®å¤åŽ: åˆ¤æ–­ä¸ºå¼€ç›˜ âœ…")
print("  å½±å“: ç³»ç»Ÿæ¢å¤æ­£å¸¸ç›‘æŽ§")

print("\n**é…ç½®æ”¯æŒ**:")
print("  ENABLE_US_PREMARKET_SIGNALS=true  âœ… ç›˜å‰ä¹°å…¥ä¿¡å·")
print("  ENABLE_AFTERHOURS_REBALANCE=true âœ… ç›˜åŽç´§æ€¥æ­¢æŸ")
print("  ç³»ç»Ÿå·²å¯ç”¨ç›˜å‰ç›˜åŽäº¤æ˜“ï¼Œæ—¶é—´åˆ¤æ–­åº”åŒ¹é…")

print("\n**ä¿®å¤èŒƒå›´ä¿å®ˆæ€§**:")
print("  ä½¿ç”¨ 16:00-æ¬¡æ—¥10:00ï¼ˆ18å°æ—¶ï¼‰è¦†ç›–æ‰€æœ‰å¯èƒ½çš„äº¤æ˜“æ—¶æ®µ")
print("  å¤ä»¤æ—¶: 16:00-08:00ï¼ˆç›˜å‰16:00å¼€å§‹ï¼Œç›˜åŽ08:00ç»“æŸï¼‰")
print("  å†¬ä»¤æ—¶: 17:00-09:00ï¼ˆç›˜å‰17:00å¼€å§‹ï¼Œç›˜åŽ09:00ç»“æŸï¼‰")
print("  ä¿å®ˆä¸Šé™10:00ç¡®ä¿ä¸ä¼šæ¼æŽ‰ä»»ä½•äº¤æ˜“æ—¶æ®µ")

print("\n" + "=" * 80)

if errors_new == 0:
    print("âœ… ä¿®å¤æˆåŠŸï¼æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡")
else:
    print(f"âŒ ä¿®å¤åŽä»æœ‰ {errors_new} ä¸ªæµ‹è¯•å¤±è´¥")

print("=" * 80)
